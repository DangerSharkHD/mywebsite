<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Optimizing Portfolio Allocation Across Major ETFs | Xavier Lopes Website</title>
<meta name="keywords" content="">
<meta name="description" content="Introduction
Optimizing portfolio allocation seems, at first sight, quite a boring and pointless task.
Many people might think that it is impossible to generate substantial returns by adjusting the allocation of value in ETFs that have historically underperformed the S&amp;P500.
That is obviously not true, allocating value in uncorrelated assets reduces overall portfolio volatility and increases risk adjusted returns.
This can be especially interesting when we add leveraged versions of the previous ETFs. Thus, allowing to beat the market in an absolute and risk adjusted basis.">
<meta name="author" content="">
<link rel="canonical" href="https://xavierlopes.com/articles/article2/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.9de45e225101e4f99701d2b68fc6b8a1ef6027928be6391fa15bf7f56326c909.css" integrity="sha256-neReIlEB5PmXAdK2j8a4oe9gJ5KL5jkfoVv39WMmyQk=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://xavierlopes.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://xavierlopes.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://xavierlopes.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://xavierlopes.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://xavierlopes.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://xavierlopes.com/articles/article2/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="https://xavierlopes.com/articles/article2/">
  <meta property="og:site_name" content="Xavier Lopes Website">
  <meta property="og:title" content="Optimizing Portfolio Allocation Across Major ETFs">
  <meta property="og:description" content="Introduction Optimizing portfolio allocation seems, at first sight, quite a boring and pointless task.
Many people might think that it is impossible to generate substantial returns by adjusting the allocation of value in ETFs that have historically underperformed the S&amp;P500.
That is obviously not true, allocating value in uncorrelated assets reduces overall portfolio volatility and increases risk adjusted returns.
This can be especially interesting when we add leveraged versions of the previous ETFs. Thus, allowing to beat the market in an absolute and risk adjusted basis.">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="articles">
    <meta property="article:published_time" content="2025-02-05T14:16:31+00:00">
    <meta property="article:modified_time" content="2025-02-05T14:16:31+00:00">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Optimizing Portfolio Allocation Across Major ETFs">
<meta name="twitter:description" content="Introduction
Optimizing portfolio allocation seems, at first sight, quite a boring and pointless task.
Many people might think that it is impossible to generate substantial returns by adjusting the allocation of value in ETFs that have historically underperformed the S&amp;P500.
That is obviously not true, allocating value in uncorrelated assets reduces overall portfolio volatility and increases risk adjusted returns.
This can be especially interesting when we add leveraged versions of the previous ETFs. Thus, allowing to beat the market in an absolute and risk adjusted basis.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "",
      "item": "https://xavierlopes.com/articles/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Optimizing Portfolio Allocation Across Major ETFs",
      "item": "https://xavierlopes.com/articles/article2/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Optimizing Portfolio Allocation Across Major ETFs",
  "name": "Optimizing Portfolio Allocation Across Major ETFs",
  "description": "Introduction Optimizing portfolio allocation seems, at first sight, quite a boring and pointless task.\nMany people might think that it is impossible to generate substantial returns by adjusting the allocation of value in ETFs that have historically underperformed the S\u0026amp;P500.\nThat is obviously not true, allocating value in uncorrelated assets reduces overall portfolio volatility and increases risk adjusted returns.\nThis can be especially interesting when we add leveraged versions of the previous ETFs. Thus, allowing to beat the market in an absolute and risk adjusted basis.\n",
  "keywords": [
    
  ],
  "articleBody": "Introduction Optimizing portfolio allocation seems, at first sight, quite a boring and pointless task.\nMany people might think that it is impossible to generate substantial returns by adjusting the allocation of value in ETFs that have historically underperformed the S\u0026P500.\nThat is obviously not true, allocating value in uncorrelated assets reduces overall portfolio volatility and increases risk adjusted returns.\nThis can be especially interesting when we add leveraged versions of the previous ETFs. Thus, allowing to beat the market in an absolute and risk adjusted basis.\nMethods Idea For this article, four ETFs will be used: SPY, QQQ, GC=F, TLT.\nFor the less experienced readers:\nSPY tracks the most significant 500 companies of NYSE and NASDAQ.\nQQQ tracks the most significant 100 companies of NASDAQ which is composed of mainly tech companies.\nGC=F tracks gold price.\nTLT tracks 20+ year US treasury bonds.\nFor this test, only the previous 20 years will be considered, from 2005 to 2025.\nImplementation The data was fetched with yfinance and processed with pandas.\nIn an initial attempt backtrader was used, however, it was found that this method was too slow, taking over 3 seconds to run a single backtest.\nFor this reason I decided to implement a custom backtest that was significantly faster taking only 300ms to run. Further optimization would be possible but at this point the extra effort would not give substantial improvements.\nAll possible weight combinations (representing portfolio allocation) with a step of 5% were tested. And the strategy with the highest sharpe ratio was chosen.\nThe 3X leverage version of the previous ETFs were calculated by multiplying the daily return by 3 and subctracting a daily fee of 0.01%.\nResults It was found that the strategy with the highest sharpe ratio had the allocation:\nSPY: 5% QQQ: 40% GC=F: 35% TLT: 20% CAGR: 0.107; Sharpe: 0.860; Max Drawdown: 25.6%.\nThe leveraged versions of the ETFs gave even better results:\nSPY: 10% QQQ: 30% GC=F: 30% TLT: 30% CAGR: 0.287; Sharpe: 0.878; Max Drawdown: 61.6%.\nConclusion This is quite a surprising result, after learning obtaining this results I started reallocating my portfolio more into QQQ and Gold.\nI have high confidence on the weight values obtained, as they are backtested on a long time period and are unlikely to be overfitted.\nStill, I would not advise to follow this exact allocation, an higher percentage allocated in SPY would give a wider market reach.\nI expect to continue this work and use a function to dynamically adjust the weights based on current market conditions that will be chosen based on major indices such as the VIX.\n",
  "wordCount" : "434",
  "inLanguage": "en",
  "datePublished": "2025-02-05T14:16:31Z",
  "dateModified": "2025-02-05T14:16:31Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://xavierlopes.com/articles/article2/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Xavier Lopes Website",
    "logo": {
      "@type": "ImageObject",
      "url": "https://xavierlopes.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://xavierlopes.com/" accesskey="h" title="Xavier Lopes Website (Alt + H)">Xavier Lopes Website</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://xavierlopes.com/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://xavierlopes.com/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://xavierlopes.com/projects/" title="Projects">
                    <span>Projects</span>
                </a>
            </li>
            <li>
                <a href="https://xavierlopes.com/articles/" title="Articles">
                    <span>Articles</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Optimizing Portfolio Allocation Across Major ETFs
    </h1>
    <div class="post-meta"><span title='2025-02-05 14:16:31 +0000 UTC'>February 5, 2025</span>

</div>
  </header> 
  <div class="post-content"><h2 id="introduction">Introduction<a hidden class="anchor" aria-hidden="true" href="#introduction">#</a></h2>
<p>Optimizing portfolio allocation seems, at first sight, quite a boring and pointless task.</p>
<p>Many people might think that it is impossible to generate substantial returns by adjusting the allocation of value in ETFs that have historically underperformed the S&amp;P500.</p>
<p>That is obviously not true, allocating value in uncorrelated assets reduces overall portfolio volatility and increases risk adjusted returns.</p>
<p>This can be especially interesting when we add leveraged versions of the previous ETFs. Thus, allowing to beat the market in an absolute and risk adjusted basis.</p>
<h2 id="methods">Methods<a hidden class="anchor" aria-hidden="true" href="#methods">#</a></h2>
<h3 id="idea">Idea<a hidden class="anchor" aria-hidden="true" href="#idea">#</a></h3>
<p>For this article, four ETFs will be used: SPY, QQQ, GC=F, TLT.</p>
<p>For the less experienced readers:</p>
<ul>
<li>
<p>SPY tracks the most significant 500 companies of NYSE and NASDAQ.</p>
</li>
<li>
<p>QQQ tracks the most significant 100 companies of NASDAQ which is composed of mainly tech companies.</p>
</li>
<li>
<p>GC=F tracks gold price.</p>
</li>
<li>
<p>TLT tracks 20+ year US treasury bonds.</p>
</li>
</ul>
<p>For this test, only the previous 20 years will be considered, from 2005 to 2025.</p>
<h3 id="implementation">Implementation<a hidden class="anchor" aria-hidden="true" href="#implementation">#</a></h3>
<p>The data was fetched with yfinance and processed with pandas.</p>
<p>In an initial attempt backtrader was used, however, it was found that this method was too slow, taking over 3 seconds to run a single backtest.</p>
<p>For this reason I decided to implement a custom backtest that was significantly faster taking only 300ms to run. Further optimization would be possible but at this point the extra effort would not give substantial improvements.</p>
<p>All possible weight combinations (representing portfolio allocation) with a step of 5% were tested. And the strategy with the highest sharpe ratio was chosen.</p>
<p>The 3X leverage version of the previous ETFs were calculated by multiplying the daily return by 3 and subctracting a daily fee of 0.01%.</p>
<h2 id="results">Results<a hidden class="anchor" aria-hidden="true" href="#results">#</a></h2>
<p>It was found that the strategy with the highest sharpe ratio had the allocation:</p>
<ul>
<li>SPY: 5%</li>
<li>QQQ: 40%</li>
<li>GC=F: 35%</li>
<li>TLT: 20%</li>
</ul>
<p>CAGR: 0.107;
Sharpe: 0.860;
Max Drawdown: 25.6%.</p>
<p><img alt="image" loading="lazy" src="/images/article2/BestSharp1.png"></p>
<p>The leveraged versions of the ETFs gave even better results:</p>
<ul>
<li>SPY: 10%</li>
<li>QQQ: 30%</li>
<li>GC=F: 30%</li>
<li>TLT: 30%</li>
</ul>
<p>CAGR: 0.287;
Sharpe: 0.878;
Max Drawdown: 61.6%.</p>
<p><img alt="image" loading="lazy" src="/images/article2/BestSharp2.png"></p>
<h2 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h2>
<p>This is quite a surprising result, after learning obtaining this results I started reallocating my portfolio more into QQQ and Gold.</p>
<p>I have high confidence on the weight values obtained, as they are backtested on a long time period and are unlikely to be overfitted.</p>
<p>Still, I would not advise to follow this exact allocation, an higher percentage allocated in SPY would give a wider market reach.</p>
<p>I expect to continue this work and use a function to dynamically adjust the weights based on current market conditions that will be chosen based on major indices such as the VIX.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://xavierlopes.com/">Xavier Lopes Website</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
